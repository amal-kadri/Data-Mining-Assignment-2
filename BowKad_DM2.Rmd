---
title: 'ECO 395 Homework 2: John Bowman, Amal Kadri'
author: "John Bowman, Amal Kadri"
date: "3/1/2022"
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
library(tidyverse)
library(ggplot2)
library(rsample)
library(lubridate)
library(caret)
library(modelr)
library(parallel)
library(foreach)
library(readr)
library(data.table)
library(dplyr)
library(tibble)
library(zoo)
library(here)
library(mosaic)
library(gamlr)


capmetro = read.csv(here("data", "capmetro_UT.csv"))
saratoga = (SaratogaHouses)
kredit = read.csv(here("data", "german_credit.csv"))
hotel_dev = read.csv(here("data", "hotels_dev.csv"))
hotel_val = read.csv(here("data", "hotels_val.csv"))
```

```{r setup, include=True}
knitr::opts_chunk$set(echo = FALSE)

capmetro = read.csv(here("data", "capmetro_UT.csv"))
capmetro = capmetro %>%
  mutate(date_time = ymd_hms(timestamp))

capmetro = capmetro %>% 
  mutate(Timestamp = timestamp)%>%
  separate(timestamp, c("Date","Time")  ,sep = " ")

capmetro$day_of_week = factor(capmetro$day_of_week, levels = c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"))

avg_board = capmetro %>% 
  group_by(hour_of_day, day_of_week, month) %>% 
  summarize(avg_pass = mean(boarding)) %>% 
  arrange(hour_of_day, day_of_week, month)
view(capmetro)

avg_board

ggplot(avg_board) +
  geom_line(aes(x = hour_of_day, y = avg_pass, col = month)) + 
  facet_wrap(~day_of_week)
  
```

```{r setup, include=True}
#One panel of scatter plots showing boardings (y) vs. temperature (x) in each 15-minute window, faceted by hour of the day, and with points colored in according to whether it is a weekday or weekend. Give the figure an informative caption in which you explain what is shown in the figure and answer the following question, citing evidence from the figure. When we hold hour of day and weekend status constant, does temperature seem to have a noticeable effect on the number of UT students riding the bus?
# These are exactly the kind of figures that Capital Metro planners might use to understand seasonal and intra-week variation in demand for UT bus service. They're also the kind of figures you'd make to assist in building a model to predict ridership (even though, in this problem you won't actually be building that model).
knitr::opts_chunk$set(echo = FALSE)

temp_board = capmetro %>%
  group_by(hour_of_day) %>%
  summarise(mean = mean(boarding))


ggplot(capmetro) +
  geom_point(aes(x=temperature, y = boarding, col = weekend)) +
  facet_wrap(~hour_of_day)

#change___

```

```{r}
saratoga = (SaratogaHouses)

head(saratoga)

houseX = model.matrix(price~(.- pctCollege - sewer - waterfront - landValue - newConstruction -heating - fuel- sewer)^2, data = saratoga)[,-1] 

houseY = saratoga$price

houseLasso = gamlr(houseX, houseY, alpha = 1)
plot(houseLasso)
lambdamin = which.min(AICc(houseLasso))

houseCoef = coef(houseLasso)
houseCoef
coefData = as.data.frame(as.matrix(houseCoef))
coefData$magnitude = round(abs(coefData$seg100),2)
coefs = coefData %>%
  filter(magnitude>0)
rownames = row.names(coefs)
rownames
saratoga_split = initial_split(saratoga, prop = 0.8)
saratoga_train = training(saratoga_split)
saratoga_test = testing(saratoga_split)

lm2 = lm(price ~ . - pctCollege - sewer - waterfront - landValue - newConstruction, data=saratoga_train)

lmLasso = lm(price ~ . - pctCollege - sewer - waterfront - landValue - newConstruction
      + lotSize + livingArea  +  bedrooms+ bathrooms + lotSize:age + lotSize:fireplaces 
      + age:livingArea + age:centralAir + livingArea:fireplaces + livingArea:bathrooms
      + livingArea:rooms + livingArea:centralAir + bedrooms:fireplaces + fireplaces:centralAir
      + bathrooms:rooms + bathrooms:centralAir, data = saratoga)

rmse(lm2, saratoga_test)
rmse(lmLasso, saratoga_test)
```

